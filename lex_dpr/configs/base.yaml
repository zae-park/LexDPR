mode: bi
out_dir: checkpoint/lexdpr
seed: 42

# 테스트 실행 모드 (true로 설정 시 1 epoch 또는 100 iteration만 실행)
test_run: false

trainer:
  epochs: 1
  lr: 2e-5
  use_amp: true
  temperature: 0.05
  eval_pairs: data/pairs_eval.jsonl
  eval_steps: 300
  k: 10
  k_values: [1,3,5,10]
  gradient_accumulation_steps: 8  # 배치 사이즈 1일 때 효과적인 배치 크기 = 1 * 8 = 8
  gradient_checkpointing: false   # PEFT 모델과 호환성 문제로 일단 비활성화
  gradient_clip_norm: 0.0  # Gradient clipping 최대 노름 (0.0이면 비활성화, 예: 1.0)
  
  # Early Stopping 설정
  early_stopping:
    enabled: false  # true로 설정하면 활성화
    metric: "cosine_ndcg@10"  # 모니터링할 메트릭 (예: "cosine_ndcg@10", "cosine_mrr@10", "cosine_recall@10")
    patience: 3  # 개선이 없을 때 기다릴 평가 횟수
    min_delta: 0.0  # 개선으로 간주할 최소 변화량
    mode: "max"  # "max" (값이 클수록 좋음) 또는 "min" (값이 작을수록 좋음)
    restore_best_weights: true  # 조기 종료 시 최고 성능 가중치로 복원할지 여부

data:
  passages: data/merged_corpus.jsonl
  pairs: data/pairs_train.jsonl
  batches:
    bi: 4              # 메모리 절약: 1로 설정하고 gradient_accumulation_steps 사용
  multiply: 0           # 필요 시 10 같이 키워 샘플 증폭

# 웹 로깅 설정 (선택사항)
# 단일 서비스 사용:
# web_logging:
#   service: wandb  # wandb, mlflow 중 선택
#   token: ${WANDB_API_KEY}  # 환경 변수 참조 또는 직접 입력
#   project: lexdpr
#   name: experiment-001  # 실행 이름 (선택사항)
#
# 여러 서비스 동시 사용:
# web_logging:
#   - service: wandb
#     token: ${WANDB_API_KEY}
#     project: lexdpr
#     name: experiment-001
#   - service: mlflow
#     token: ${MLFLOW_TRACKING_TOKEN}  # 선택사항
#     tracking_uri: http://localhost:5000
#     experiment_name: lexdpr
#     run_name: experiment-001

