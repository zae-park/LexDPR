name: ğŸ”„ Auto Mirror to Organization Repo
# RICHER ì¡°ì§ì— mirror

# íŠ¸ë¦¬ê±° : ëª¨ë“  ë¸Œëœì¹˜(refs/heads/**) & ëª¨ë“  íƒœê·¸(refs/tags/**)ê°€ í‘¸ì‹œë  ë•Œ
on:
  push:
    branches:
      - '**'
    tags:
      - '**'

jobs:
  mirror_repo:
    runs-on: ubuntu-latest
    if: success() && secrets.ORG_REPO_TOKEN

    steps:
      - name: ğŸ›‘ Check if Push is to a Non-Head Ref (Optional - For safety)
        run: echo "Starting mirror process..."
        
      - name: ğŸ“¥ Checkout Source Repository (Full History)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 
          
      - name: ğŸ”— Add Target Remote and Push All Refs (Mirror)
        env:
          ORG_TOKEN: ${{ secrets.ORG_REPO_TOKEN }}
          ORG_REPO_URL: "https://github.com/richer4p/LexDPR.git"

        run: |
          # URLì— ì¸ì¦ ì •ë³´ í¬í•¨
          NEW_REMOTE="https://${{ github.actor }}:${ORG_TOKEN}@$(echo $ORG_REPO_URL | sed -e 's/https:\/\///')"
          
          # 2. ìƒˆ ì›ê²© ì €ì¥ì†Œë¥¼ ë³„ì¹­(org-mirror)ìœ¼ë¡œ ì¶”ê°€
          git remote add org-mirror "$NEW_REMOTE"
          
          # 3. í˜„ì¬ ë ˆí¬ë¥¼ í†µì±„ë¡œ ë¯¸ëŸ¬ë§ í‘¸ì‹œ
          echo "Mirroring all branches and tags to $ORG_REPO_URL..."
          git push org-mirror --mirror
          echo "Mirroring complete."
