name: ğŸ”„ Auto Mirror to Organization Repo

# ê°œì¸ ë ˆí¬ì— í‘¸ì‹œ ë˜ëŠ” íƒœê·¸ ìƒì„± ì‹œ ì‘ë™
on:
  push:
    branches:
      - '**' # ëª¨ë“  ë¸Œëœì¹˜ì—ì„œ í‘¸ì‹œ ë°œìƒ ì‹œ
    tags:
      - '**' # ëª¨ë“  íƒœê·¸ ìƒì„± ì‹œ

jobs:
  mirror_repo:
    # ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë  í™˜ê²½
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Source Repository (Full History)
        # ë¯¸ëŸ¬ë§ì„ ìœ„í•´ ì „ì²´ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”— Mirror to Organization Repo
        env:
          # ê°œì¸ ë ˆí¬ì˜ Secretsì— ë“±ë¡ëœ ì¡°ì§ ì ‘ê·¼ í† í° (Classic PAT)
          ORG_TOKEN: ${{ secrets.MIRROR_TOKEN }}
          # ì¡°ì§ ì´ë¦„/ë ˆí¬ ì´ë¦„. ì¡°ì§ ë ˆí¬ì˜ ê²½ë¡œë¥¼ ì—¬ê¸°ì— ëª…ì‹œí•©ë‹ˆë‹¤.
          # ì˜ˆì‹œ: richer4p/LexDPR.git
          TARGET_REPO_PATH: "richer4p/LexDPR.git" 
          HOST: "github.com"
          
        run: |
          # 1. í† í° í™˜ê²½ ë³€ìˆ˜ ê²€ì‚¬
          if [ -z "$ORG_TOKEN" ]; then
            echo "âŒ MIRROR_TOKEN is not set in secrets."
            exit 1
          fi
          
          # 2. ì›ê²© URL êµ¬ì„± (í† í°ì„ ì‚¬ìš©í•˜ì—¬ HTTPS ì¸ì¦)
          # PATë¥¼ ë¹„ë°€ë²ˆí˜¸ì²˜ëŸ¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦í•˜ëŠ” í‘œì¤€ ë°©ì‹ì…ë‹ˆë‹¤.
          NEW_REMOTE="https://x-access-token:${ORG_TOKEN}@${HOST}/${TARGET_REPO_PATH}"
          
          echo "ğŸ¯ Target repository: https://${HOST}/${TARGET_REPO_PATH}"
          
          # 3. ì›ê²© ì €ì¥ì†Œ ì¶”ê°€
          # 'org-mirror'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¡°ì§ ë ˆí¬ë¥¼ ì›ê²© ì €ì¥ì†Œë¡œ ì¶”ê°€
          git remote add org-mirror "$NEW_REMOTE"
          
          # 4. ë¯¸ëŸ¬ë§ í‘¸ì‹œ ì‹¤í–‰
          echo "ğŸ”„ Mirroring all branches and tags..."
          # '--mirror' ì˜µì…˜ì€ ëª¨ë“  ë¸Œëœì¹˜, íƒœê·¸ ë“±ì„ ë®ì–´ì”ë‹ˆë‹¤.
          git push org-mirror --mirror
          
          echo "âœ… Mirroring complete!"