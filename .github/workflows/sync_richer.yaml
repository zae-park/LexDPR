name: ğŸ”„ Auto Mirror to Organization Repo
# RICHER ì¡°ì§ì— mirror

on:
  push:
    branches:
      - '**'
    tags:
      - '**'

jobs:
  mirror_repo:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Source Repository (Full History)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” Debug - Check Token
        env:
          ORG_TOKEN: ${{ secrets.ORG_REPO_TOKEN }}
        run: |
          if [ -z "$ORG_TOKEN" ]; then
            echo "âŒ ORG_TOKEN is empty or not set"
            exit 1
          fi
          echo "âœ… ORG_TOKEN is set"
          echo "Token length: ${#ORG_TOKEN}"
          
          # í† í° ì• 4ìë¦¬ë§Œ í‘œì‹œ (ë””ë²„ê¹…ìš©)
          echo "Token prefix: ${ORG_TOKEN:0:4}..."

      - name: ğŸ”— Test Connection
        env:
          ORG_TOKEN: ${{ secrets.ORG_REPO_TOKEN }}
        run: |
          TARGET_REPO="github.com/richer4p/LexDPR.git"
          
          echo "Testing connection to https://${TARGET_REPO}"
          
          # ls-remoteë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
          if git ls-remote "https://zae-park:${ORG_TOKEN}@${TARGET_REPO}" > /dev/null 2>&1; then
            echo "âœ… Connection successful"
          else
            echo "âŒ Connection failed"
            exit 1
          fi

      - name: ğŸ”— Mirror to Organization Repo
        env:
          ORG_TOKEN: ${{ secrets.ORG_REPO_TOKEN }}
        run: |
          TARGET_REPO="github.com/richer4p/LexDPR.git"
          NEW_REMOTE="https://zae-park:${ORG_TOKEN}@${TARGET_REPO}"
          
          echo "Target repository: https://${TARGET_REPO}"
          
          # ì›ê²© ì €ì¥ì†Œ ì¶”ê°€
          git remote add org-mirror "$NEW_REMOTE"
          
          # ë¯¸ëŸ¬ë§ í‘¸ì‹œ
          echo "Mirroring all branches and tags..."
          git push org-mirror --mirror
          echo "âœ… Mirroring complete."